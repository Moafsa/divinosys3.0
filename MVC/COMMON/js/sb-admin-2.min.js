/*!
 * Start Bootstrap - SB Admin 2 v4.0.2 (https://startbootstrap.com/template-overviews/sb-admin-2)
 * Copyright 2013-2019 Start Bootstrap
 * Licensed under MIT (https://github.com/BlackrockDigital/startbootstrap-sb-admin-2/blob/master/LICENSE)
 */

// Call the dataTables jQuery plugin
$(document).ready(function() {
  // Inicializa DataTables se existir e não estiver já inicializado
  if ($.fn.DataTable && !$.fn.DataTable.isDataTable('#dataTable')) {
    $('#dataTable').DataTable({
      language: {
        url: '//cdn.datatables.net/plug-ins/1.10.24/i18n/Portuguese-Brasil.json'
      }
    });
  }

  // Força a sidebar a ficar recolhida em desktop
  if ($(window).width() > 768) {
    $("body").addClass("sidebar-toggled");
    $(".sidebar").addClass("toggled");
  }

  // Adiciona tooltips aos itens do menu
  $('.sidebar .nav-item .nav-link').each(function() {
    const text = $(this).find('span').text().trim();
    $(this).attr('data-title', text);
  });

  // Cria o menu mobile e overlay
  if ($('.mobile-menu').length === 0) {
    const mobileMenu = `
      <div class="mobile-menu">
        <div class="mobile-menu-header">
          <h5 class="text-white mb-0">Menu</h5>
          <button class="mobile-menu-close">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="mobile-menu-items">
          ${$('.sidebar .nav').html()}
        </div>
      </div>
      <div class="mobile-menu-overlay"></div>
    `;
    $('body').append(mobileMenu);
  }

  // Toggle do menu mobile
  $("#sidebarToggleTop").on('click', function(e) {
    e.preventDefault();
    $('.mobile-menu, .mobile-menu-overlay').addClass('show');
    $('body').css('overflow', 'hidden');
  });

  // Fecha o menu mobile
  $(".mobile-menu-close, .mobile-menu-overlay").on('click', function(e) {
    e.preventDefault();
    $('.mobile-menu, .mobile-menu-overlay').removeClass('show');
    $('body').css('overflow', '');
  });

  // Fecha o menu ao clicar em um item (em mobile)
  $('.mobile-menu .nav-link').on('click', function() {
    if ($(window).width() <= 768) {
      $('.mobile-menu, .mobile-menu-overlay').removeClass('show');
      $('body').css('overflow', '');
    }
  });

  // Ajusta o layout quando redimensionar a janela
  let resizeTimer;
  $(window).on('resize', function() {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(function() {
      if ($(window).width() > 768) {
        $('.mobile-menu, .mobile-menu-overlay').removeClass('show');
        $('body').css('overflow', '');
        $("#content-wrapper").css("margin-left", "4.5rem");
      } else {
        $("#content-wrapper").css("margin-left", "0");
      }
    }, 250);
  });

  // Previne scroll do content quando hover na sidebar
  $('.sidebar').on('mousewheel DOMMouseScroll wheel', function(e) {
    if ($(this).get(0).scrollHeight > $(this).height()) {
      var e0 = e.originalEvent;
      var delta = e0.wheelDelta || -e0.detail;
      this.scrollTop += (delta < 0 ? 1 : -1) * 30;
      e.preventDefault();
    }
  });

  // Scroll to top button
  $(document).on('scroll', function() {
    var scrollDistance = $(this).scrollTop();
    if (scrollDistance > 100) {
      $('.scroll-to-top').fadeIn();
    } else {
      $('.scroll-to-top').fadeOut();
    }
  });

  // Smooth scrolling
  $(document).on('click', 'a.scroll-to-top', function(e) {
    e.preventDefault();
    $('html, body').animate({
      scrollTop: 0
    }, 500);
  });
});